<!DOCTYPE html>
<html>
<head>
    <title>Ascension | Crossed Banners</title>
    <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>
</head>
<body>

<div class="ui hidden failed negative message">
  <i class="close icon"></i>
  <div class="header">
    We're sorry - Login failed for some reason.
  </div>
  <p>Please contact m@type.hk for support.
</p></div>

<!-- Sidebar Menu -->
<div class="ui inverted vertical sidebar menu">
  <a href="http://tijptjik.github.io/ascension/" class="active item">Home</a>
  <a href="http://ascension.hype.hk" class="item">Rules</a>
  <a class="item disabled">Leaderboard</a>
</div>


<!-- Page Contents -->
  <div class="ui vertical masthead center aligned segment">

    <div class="ui container">
      <div class="ui large secondary pointing menu">
        <a class="toc item">
          <i class="sidebar icon"></i>
        </a>
        <a href="http://tijptjik.github.io/ascension/" class="active item">Home</a>
        <a href="http://ascension.hype.hk" class="item">Rules</a>
        <a class="item disabled">Leaderboard</a>
      </div>
    </div>

  </div>

<div class="ui text container">
    <form class="ui form">
        <div class="ui">
            <h2 style="text-align: center;">JOIN THE GAME</h2>
        </div>
    <h4 class="ui horizontal divider header">
      <i class="bar university icon"></i>
      Personal Details
    </h4>
      <div class="field">
        <label>Full Name</label>
        <input placeholder="e.g. Mart van de Ven" name="name" type="text">
      </div>
      <div class="field">
        <label>E-mai  l Address</label>
        <input placeholder="e.g. m@type.hk" name="email" type="text">
      </div>
      <div class="field">
        <label>Game of Thrones Alias</label>
        <input placeholder="e.g. Ser Killsalot" name="alias" type="text">
      </div>
      <div class="field">
        <label>House - Assigned by the Game Master</label>
        <select class="ui dropdown" name="house">
          <option value="">Select</option>
        </select>
        <div class="ui accordion field">
          <div class="title">
            <i class="icon dropdown"></i>
            HELP : I wasn't assigned a House!?
          </div>
          <div class="content field">
            <p>Please get in touch with <a href="mailto:m@type.hk">Game Master</a> for assistance</p>
          </div>
        </div>
      </div>
      <h4 class="ui horizontal divider header">
          <i class="bar diamond icon"></i>
          Drafting Characters
        </h4>
        Characters are listed with their house colour and name. Between brackets you'll find their Prominence, Violence and Diplomacy powers.
        <div class="ui accordion field">
          <div class="title">
            <i class="icon dropdown"></i>
            HELP : How do I select my characters?
          </div>
          <div class="content field">
            <div class="ui celled ordered list">
              <div class="item">Pick characters which excell at being <a target="_blank" href="https://github.com/tijptjik/ascension/blob/gh-pages/S06/rules.md#award-categories">violent, witty, cunning, supportive or stylish</a>.</div>
              <div class="item">Consider their <a target="_blank" href="https://github.com/tijptjik/ascension/blob/gh-pages/S06/rules.md#prominence-multiplier">Prominence</a> - the roman numeral behind their name - Greater prominence makes it harder for them to score points.</div>
              <div class="item">Pick at least some characters with strong Violence and Diplomany Powers - See <a target="_blank" href="https://github.com/tijptjik/ascension/blob/gh-pages/S06/character.powers.csv">Character Powers</a> for a full list</div>
              <div class="item">Avoid obvious choices - they will get killed.</div>
            </div>
          </div>
          <div class="title">
            <i class="icon dropdown"></i>
            HELP : What do the character colours mean?
          </div>
          <div class="content field">
            <div class="ui divided aligned list housecolours"></div>
          </div>
        </div>
      <div class="field">
        <label>Slot I</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char1">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
          </div>
      </div>
      <div class="field">
        <label>Slot II</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char2">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
        </div>
      </div>
        <div class="field">
        <label>Slot III</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char3">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
          </div>
      </div>
      <div class="field">
        <label>Slot IV</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char4">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
        </div>
      </div>
      <div class="field">
        <label>Slot V</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char5">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
        </div>
      </div>
      <div class="field">
        <label>Slot VI</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char6">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
        </div>
      </div>
      <div class="field">
        <label>Slot VII</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="char7">
          <i class="dropdown icon"></i>
          <div class="default text">Select Character</div>
          <div class="menu characters">
          </div>
        </div>
      </div>
      <br>
      <div class="fluid ui button submit inverted huge blue center">Submit</div>
      <div class="ui error message"></div>
    </form>
    <br>
    <br>
    <br>

</div>






<script src="semantic/dist/semantic.min.js"></script>

<script>

var db = new Firebase("https://ascension.firebaseio.com");

var USER_TEMPLATE = {
        "full_name" : "",
        "first_name" : "",
        "alias" : "",
        "alias_short" : "",
        "email": "",
        "facebook" : "",
        "games": true
    }

db.authWithOAuthPopup("facebook", function(error, authData) {
  if (error) {

    $('.message.failed')
      .transition('drop');

  } else {
    is_player(authData);
  }
},{'remember':'default','scope':'public_profile,email'});

var is_player = function(authData){
    db.child('players')
      .child(authData.uid)
      .once('value', function(snapshot){
        // if data exists
        if (snapshot.exists()) {
            // get the ref (in this case /users/2) and update its contents
            console.log("User exists!");
            // snapshot.ref().update(user);
        } else {
            console.log('new')
            // data does not exist so we wrap the data in an object with
            // a member named after the uid so we can pass it as an update
            // to the parent.
            var fb = authData.facebook;
            var payload = {};
                user = USER_TEMPLATE;
                user['full_name'] = fb.displayName;
                user['email'] = fb.email;
                user['facebook'] = fb.id;
                try{
                    user['first_name'] = fb.cachedUserProfile.first_name;
                }
                catch(e){
                    user['first_name'] = 'Anon';    
                }

                payload[authData.uid] = user;
            // get the ref's parent and call update on it.
            snapshot.ref().parent().update(payload);
        }
    });
    
}

function populateCharacterDropdowns(chars){
  var numerals = [0,'I','II','III','IV','V']
  var colors = {
    'bolton' : 'red',
    'meereen' : 'brown',
    'arryn' : 'blue',
    'greyjoy' : 'black',
    'martell' : 'orange',
    'independent' : 'pink',
    'nightswatch' : 'grey',
    'minor' : 'olive',
    'targaryen' : 'purple',
    'tyrell' : 'green',
    'lannister' : 'yellow',
    'stark' : 'grey'
  }

  db.child('houses').once('value',function(snapshot){
    var houses = snapshot.val();
    for (var house in colors) {
        if (colors.hasOwnProperty(house)) {
          var html = '<div class="item"><i class="ui '+colors[house]+' certificate large icon"></i><div class="content" style="vertical-align: middle;">'+houses[house].name+'</div>'
          $('.housecolours').append(html);
          $('select[name="house"]').append('<option value="'+house+'">'+houses[house].name+'</option>');
        }
    }
  })

  

  var html = "";
  for (var character in chars) {
    if (chars.hasOwnProperty(character)) {
      var char = chars[character]
      var str = '<div class="item" data-value="'+char.id+'"><div class="ui '+colors[char.house]+' empty circular label"></div>'+char.name+ ' ('+numerals[char.prominence] +'-'+char.violence+'/'+char.diplomacy+')</div>'
      html += str;
    }
  }
  $('.menu.characters').append(html);

  $('.ui.dropdown')
      .dropdown({ fullTextSearch: true })
    ;
}

db.child('characters').once('value', function(snapshot){
  var characters = snapshot.val()
  populateCharacterDropdowns(characters);
});



// Semantic UI

$(document)
    .ready(function() {

      $('.message .close')
        .on('click', function() {
          $(this)
            .closest('.message')
            .transition('fade')
          ;
        })
      ;

      // create sidebar and attach to menu open
      $('.ui.sidebar')
        .sidebar('attach events', '.toc.item');

      $('.ui.accordion').accordion();

          $('.ui.form')
  .form({
    fields: {
      name: {
        identifier: 'name',
        rules: [
          {
            type   : 'empty',
            prompt : 'Please enter your full name'
          }
        ]
      },
    alias: {
        identifier: 'alias',
        rules: [
          {
            type   : 'empty',
            prompt : 'Please enter your Player Name'
          }
        ]
      },
      email: {
        identifier: 'email',
        rules: [
          {
            type   : 'email',
            prompt : 'Please enter your email'
          }
        ]
      },
      house: {
        identifier: 'house',
        rules: [
          {
            type   : 'empty',
            prompt : 'Please indicate your House'
          }
        ]
      },
      char1: {
        identifier: 'char1',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char2]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char3]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char4]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char5]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char6]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char7]',
            prompt : 'You cant select the same character twice'
          },
        ]
      },
    char2: {
        identifier: 'char2',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char1]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char3]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char4]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char5]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char6]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char7]',
            prompt : 'You cant select the same character twice'
          },
        ]
      },
    char3: {
        identifier: 'char3',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char2]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char1]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char4]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char5]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char6]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char7]',
            prompt : 'You cant select the same character twice'
          },
        ]
      },
            char4: {
        identifier: 'char4',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char2]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char3]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char1]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char5]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char6]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char7]',
            prompt : 'You cant select the same character twice'
          },
        ]
      },
            char5: {
        identifier: 'char5',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char2]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char3]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char4]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char1]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char6]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char7]',
            prompt : 'You cant select the same character twice'
          },
        ]
      },
            char6: {
        identifier: 'char6',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char2]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char3]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char4]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char5]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char1]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char7]',
            prompt : 'You cant select the same character twice'
          },
        ]
      },
            char7: {
        identifier: 'char7',
        rules: [
          {
            type : 'empty',
            prompt : 'You haven\'t selected all 7 characters.'
          },
          {
            type   : 'different[char2]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char3]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char4]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char5]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char6]',
            prompt : 'You cant select the same character twice'
          },
          {
            type   : 'different[char1]',
            prompt : 'You cant select the same character twice'
          },
        ]
      }
    }
  })
;

$('.ui.button.submit').click(function(e){
    console.log($('form').form('get values'));
});

    })
  ;
</script>
</body>
</html>